{% extends 'base.html' %}
{% load static %}
{% load cloudinary %}
{% load easy_maps_tags %}

{% block google %}
<script src="https://maps.google.com/maps/api/js?key={{googleapi}}&sensor=false" type="text/javascript"></script>
{% endblock %}

{% block title %}
Bach Please | {{header}}
{% endblock %}


{% block content %}
</br>
<h1> Start Planning </h1> 
<form method="get" action="{% url 'filter_view' %}">
     {% csrf_token %} 
     {{ city_filter.form }}
      <button type="submit" class="btn btn-primary">Submit</button>
</form>
</br>


{% for head in header %}
<h1>Events in {{head}}</h1>
{% endfor %}

    <h3>List </h3>
    {% for event in events %}
    <a href="{% url 'event_detail' event.pk %}">
        <h3>{{event.name}}</h3>
        <p>{{event.description|safe}}</p>
        <p>{{event.neighborhood}}</p>
        <p>{{event.lat}}</p>
        <p>{{event.long}}</p>
        <img src = "https://res.cloudinary.com/skim121/image/upload/c_fill,g_face,h_300,w_300/{{event.image}}" alt="{{event.name}} image">
    <hr>
    </a>
    {% endfor %}  

    
    <h2>Map</h2>

    <div id="map" style="width: 500px; height: 400px;">
    </div>

    <script type="text/javascript">

        let locations = [
        {% for event in events %}
            ['{{event.name}}',{{event.lat}},{{event.long}}],
        {% endfor%}
        ]

        let cityheader = [
        {% for head in header %}
            '{{head}}',
        {% endfor%}
        ]
        
        if(cityheader[0]=="Austin"){
            baselat = 30.26;
            baselong = -97.75; 
        }

        if(cityheader[0]=="Nashville"){
            baselat = 36.17;
            baselong = -86.78; 
        }

        if(cityheader[0]=="Miami"){
            baselat = 25.80;
            baselong = -80.18; 
        }

        let map = new google.maps.Map(document.getElementById('map'), {
            zoom: 11,
            center: new google.maps.LatLng(baselat, baselong),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });
    
        let infowindow = new google.maps.InfoWindow();
    
        let marker, i;
    
        for (i = 0; i < locations.length; i++) {  
          marker = new google.maps.Marker({
            position: new google.maps.LatLng(locations[i][1], locations[i][2]),
            map: map
          });
    
          google.maps.event.addListener(marker, 'click', (function(marker, i) {
            return function() {
              infowindow.setContent(locations[i][0]);
              infowindow.open(map, marker);
            }
          })(marker, i));
        }
    </script>

{% endblock %}

